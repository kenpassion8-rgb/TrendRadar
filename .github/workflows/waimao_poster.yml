name: 外贸日报海报

on:
  schedule:
    # 每天北京时间 08:30 运行（TrendRadar 会先跑，我们晚半小时读结果）
    # UTC 时间 00:30
    - cron: '30 0 * * *'
  workflow_dispatch:  # 支持手动触发测试

jobs:
  generate-poster:
    runs-on: ubuntu-latest
    timeout-minutes: 20

    steps:
      # ── 1. 拉取代码 ──────────────────────────────────────
      - name: 检出仓库
        uses: actions/checkout@v4

      # ── 2. 安装 Python ───────────────────────────────────
      - name: 安装 Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: 安装 Python 依赖
        run: pip install requests

      # ── 3. 安装 Node.js + Playwright（生成海报图片用）───
      - name: 安装 Node.js 18
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: 安装 Playwright Chromium
        run: |
          npm install playwright
          npx playwright install chromium
          npx playwright install-deps chromium

      # ── 4. 生成海报 + 发送企业微信 ───────────────────────
      - name: 生成海报并发送
        run: python scripts/poster_and_send.py
        env:
          KIMI_API_KEY:      ${{ secrets.KIMI_API_KEY }}
          WEWORK_WEBHOOK_URL: ${{ secrets.WEWORK_WEBHOOK_URL }}
          WECOM_CORP_ID:     ${{ secrets.WECOM_CORP_ID }}
          WECOM_AGENT_ID:    ${{ secrets.WECOM_AGENT_ID }}
          WECOM_APP_SECRET:  ${{ secrets.WECOM_APP_SECRET }}
